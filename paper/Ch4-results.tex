% Ch4-results.tex
%
% vim: set ft=tex:
\section{Results} \label{sec:results}

\subsection{Observed numerical stability}

\begin{figure}[ht!]
    \centering
    \begin{tikzpicture}[scale=0.8]
        \input{figs/initial-volumes-level-out.pgfplot}
        \input{figs/initial-volumes-too-constricted.pgfplot}
    \end{tikzpicture}
    \caption{
        Simulated volume at the start of a breathing cycle, with varied initial volumes. Both
        experiments with a symmetric model with a depth of 6 (i.e., 63 total branches). Graphs
        display the distinction between unrestricted (left) vs 80\% constriction (right).
        \textbf{Note:} displayed timespan differs between the left and right graphs.
    }
    \label{fig:different-initial-volumes}
\end{figure}

To be confident in the results of other experiments, it is first crucial to determine that the
simulation remains stable after running for extended periods of time. To do this, we simulated a
simpler model (fully symmetric, no constriction, depth of 6) for 1000 seconds~--~which required
100,000 simulation ticks.

It is at this point that we'd ideally reference some figure to show that the system is stable in
this configuration, but the series of volumes at each timestamp~--~starting at 0, 100, and 1000
seconds~--~were all the same, up to nine significant figures. In other words, total volume of air in
the lungs over the course of each ``breath'' did not change over the course of an atypically lengthy
experiment.

\breakpars

We also considered that the initial volume used in experimentation is not guaranteed to be accurate
to the ``typical'' volume at that point in the breathing cycle~--~a fact that becomes visible with
higher degrees of airway constriction (discussed later in this section). Therefore, we also
experimented with significantly changed initial volumes, as shown above in
\autoref{fig:different-initial-volumes}. The system quickly recovers from pertubations when
airflow is unrestricted, but is slower to return to the typical volume when resistance prevents the
correction from being made more quickly.

\subsection{Flow characteristics under varied constriction}

\begin{figure}[ht!]
    \centering
    \begin{tikzpicture}
        \input{figs/constricted-flow-characteristics.pgfplot}
    \end{tikzpicture}
    \caption{ todo -- needs colors \& should be twice as long. }
    \label{fig:constricted-flow-characteristics}
\end{figure}

\todo{
    This section should basically just say: yeah, this is expected. It should reference whatever
    other papers have previously reported on these phenomena.

    We delay until 20s after starting because we know from above that longer adjustment periods are
    required for constricted flow.
}

\subsection{Comparison of interpolation functions}

\begin{figure}[ht!]
    \centering
    \begin{tikzpicture}
        \input{figs/interpolation-functions.pgfplot}
    \end{tikzpicture}
    \caption{Comparison of the four selected interpolation functions}
\end{figure}

Later experiments explore the effects of rapid changes in airway constriction. To move between these
``constricted'' and ``unconstricted'' states, we have four different interpolation functions:

\begin{itemize}
    \item \textit{Linear}: $f(x) = x$
    \item \textit{Tanh}: $f(x) = \frac{1}{2} \frac{\tanh(6x - 3)}{\tanh(3)} + \frac{1}{2}$
    \item \textit{Trigonometric}: $f(x) = \frac{1}{2} (1 - \cos(\pi x))$
    \item \textit{Cubic}: $f(x) = 3x^2 - 2x^3$
\end{itemize}

\noindent
A visual comparison of these functions is provided in \autoref{fig:interpolate-functions}.

These functions were selected for their relative simplicity and variety of curvature.

\todo{
    Explaining exactly why the curvature is necessary is escaping me right now. It's basically that
    the flow behaves extra weirdly without curvy interpolation, but that's not very scientific.

    There's an alternate angle, which is that curvy interpolation intentionally allows the
    significant changes at high constriction to happen more slowly (e.g. going 10\% to 15\% is much
    slower than 15\% to 20\%). This is ``good'' because flow characteristics change rapidly as you
    change constriction \textit{from} high constrictions, so moving slowly ensures that the flow is
    less erratic.

    On the other hand, maybe this is biasing the results and \textit{actually} the erratic flow is
    more realistic. Would be good to discuss.
}

\todo{
    The other piece of writing in this section is going to be a comparison of the flow
    characteristics when when switching on various interpolation methods.

    We eventually choose \textit{Tanh}, basically because it looks the best (subject to change!).
    See above notes.
}

\breakpars

Finally, it is worth noting that the correction factor of $\tanh(3)$ in the denominator of the
\textit{Tanh} interpolation function is nearly equal to 1, but still necessary. The value of
$\tanh(3)$ is only 0.995, but experiments without that correction factor showed clearly visible
instantaneous changes in flow from that small change. While these changes were most likely harmless,
we still elected to remove them.

\newpage

\todo{
    Here's an outline of the remaining items I'd like to put in this section, in a rough order:
}

\begin{itemize}
    \item Stable flow characteristics of lungs with varying degradation
        \begin{itemize}
            \item Basically just want to point out the ways that the curve starts to become
                lopsided and out of phase from the pleural pressure, with particular emphasis on
                the way that the effect starts rapidly heightening as the constriction
                approaches 10\% (about~--~I haven't tested beyond that, which I should).
        \end{itemize}
    \item Onset and recovery from airflow constriction. Key things are:
        \begin{itemize}
            \item Just showing off the simple graphs, to get a sense of what's going on
            \item Slow recovery reduces strain~--~we can get abnormally high airflow if pleural
                pressure lines up with suddenly-reduced constriction 
            \item Relating to above: I'd like to have a version of the crazy graph~--~the one
                where it's all just ``degrade and recover'', with each startpoint being offset
                by 0.5s from the previous one. It would be really good to align that with some
                kind of chart showing the minimum and maximum flow velocity reached (on top of
                the normal min/max), to show the kind of chance of risk we run~--~and how much
                that reduces as the recovery becomes slower.
            \item Flow characteristics align with those from the current level of constriction
                (i.e. on the way to 10\%, the area around 20\% constriction tends to mimic the
                flow characteristics from 20\% at that point)
            \item The above points are probably three distinct sub-sections.
        \end{itemize}
\end{itemize}
